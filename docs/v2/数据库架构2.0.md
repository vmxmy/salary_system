{
  "description": "Final HR and Payroll System Database Structure based on principles of minimizing hardcoding, externalizing config/rules, using JSONB for variable items, effective dating, and validated against data examples.",
  "schemas": [
    {
      "name": "config",
      "description": "Stores system-wide configurations, lookup values, rules, and definitions.",
      "tables": [
        {
          "name": "lookup_types",
          "description": "Defines categories for lookup values (e.g., EmployeeStatus, ContractType).",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique code for the lookup type" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Human-readable name for the lookup type" },
            { "name": "description", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Description of the lookup type" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [ { "name": "uq_lookup_types_code", "columns": ["code"] } ],
          "check_constraints": []
        },
        {
          "name": "lookup_values",
          "description": "Stores the actual lookup values within categories.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "lookup_type_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to lookup_types" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": false, "default": null, "comment": "Unique code for the lookup value within its type" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Human-readable name for the lookup value" },
            { "name": "description", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Description of the lookup value" },
            { "name": "sort_order", "data_type": "INTEGER", "nullable": false, "unique": false, "default": "0", "comment": "Order for displaying values" },
            { "name": "is_active", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether the lookup value is active" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_lookup_values_type", "from_columns": ["lookup_type_id"], "to_table": "config.lookup_types", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [ { "name": "uq_lookup_values_type_code", "columns": ["lookup_type_id", "code"] } ],
          "check_constraints": []
        },
        {
          "name": "system_parameters",
          "description": "Stores general system parameters.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "key", "data_type": "VARCHAR(100)", "nullable": false, "unique": true, "default": null, "comment": "Unique parameter key" },
            { "name": "value", "data_type": "TEXT", "nullable": false, "unique": false, "default": null, "comment": "Parameter value" },
            { "name": "description", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Description of the parameter" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [ { "name": "uq_system_parameters_key", "columns": ["key"] } ],
          "check_constraints": []
        },
        {
          "name": "payroll_component_definitions",
          "description": "Defines the various earning and deduction components.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique code for the component" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Name of the component (e.g., Basic Salary, Income Tax)" },
            { "name": "type", "data_type": "VARCHAR(20)", "nullable": false, "unique": false, "default": null, "comment": "Component type (Earning or Deduction)" },
            { "name": "calculation_method", "data_type": "VARCHAR(50)", "nullable": true, "unique": false, "default": null, "comment": "Method used for calculation (e.g., FixedAmount, Percentage, Formula)" },
            { "name": "calculation_parameters", "data_type": "JSONB", "nullable": true, "unique": false, "default": null, "comment": "Parameters for the calculation method" },
            { "name": "is_taxable", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether this component is subject to income tax" },
             { "name": "is_social_security_base", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "FALSE", "comment": "Whether this component contributes to social security base" },
             { "name": "is_housing_fund_base", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "FALSE", "comment": "Whether this component contributes to housing fund base" },
            { "name": "display_order", "data_type": "INTEGER", "nullable": false, "unique": false, "default": "0", "comment": "Order for displaying on payslip" },
            { "name": "is_active", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether this component is active" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Definition effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Definition end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [ { "name": "uq_payroll_component_definitions_code", "columns": ["code"] } ],
          "check_constraints": [ { "name": "chk_payroll_component_type", "expression": "type IN ('Earning', 'Deduction')" } ]
        },
        {
          "name": "tax_brackets",
          "description": "Stores income tax rate brackets.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "region_code", "data_type": "VARCHAR(50)", "nullable": false, "unique": false, "default": null, "comment": "Region code (e.g., CN, US-CA)" },
            { "name": "tax_type", "data_type": "VARCHAR(50)", "nullable": false, "unique": false, "default": null, "comment": "Type of tax (e.g., IncomeTax)" },
            { "name": "income_range_start", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": null, "comment": "Income range start amount" },
            { "name": "income_range_end", "data_type": "NUMERIC(18, 4)", "nullable": true, "unique": false, "default": null, "comment": "Income range end amount (null for highest bracket)" },
            { "name": "tax_rate", "data_type": "NUMERIC(5, 4)", "nullable": false, "unique": false, "default": null, "comment": "Tax rate as a decimal (e.g., 0.03)" },
            { "name": "quick_deduction", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Quick deduction amount" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Bracket effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Bracket end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [],
          "check_constraints": [
             { "name": "chk_tax_bracket_range", "expression": "income_range_start < income_range_end OR income_range_end IS NULL" }
          ]
        },
         {
          "name": "social_security_rates",
          "description": "Stores social security and housing fund contribution rates.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "region_code", "data_type": "VARCHAR(50)", "nullable": false, "unique": false, "default": null, "comment": "Region code (e.g., CN-Shanghai)" },
            { "name": "contribution_type", "data_type": "VARCHAR(50)", "nullable": false, "unique": false, "default": null, "comment": "Contribution type (e.g., Pension, Medical, HousingFund)" },
            { "name": "participant_type", "data_type": "VARCHAR(20)", "nullable": false, "unique": false, "default": null, "comment": "Participant (Employee or Employer)" },
            { "name": "rate", "data_type": "NUMERIC(5, 4)", "nullable": false, "unique": false, "default": null, "comment": "Contribution rate as a decimal" },
            { "name": "base_min", "data_type": "NUMERIC(18, 4)", "nullable": true, "unique": false, "default": null, "comment": "Contribution base minimum" },
            { "name": "base_max", "data_type": "NUMERIC(18, 4)", "nullable": true, "unique": false, "default": null, "comment": "Contribution base maximum" },
            { "name": "fixed_amount", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Fixed contribution amount if applicable" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Rate effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Rate end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [],
          "check_constraints": [ { "name": "chk_ss_rate_participant_type", "expression": "participant_type IN ('Employee', 'Employer')" } ]
        }
      ]
    },
    {
      "name": "hr",
      "description": "Stores core employee and organization data.",
      "tables": [
        {
          "name": "employees",
          "description": "Core employee demographic information.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique employee ID/Code" },
            { "name": "first_name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Employee's first name" },
            { "name": "last_name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Employee's last name" },
            { "name": "date_of_birth", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Employee's date of birth" },
            { "name": "gender_lookup_value_id", "data_type": "BIGINT", "nullable": true, "unique": false, "default": null, "comment": "Foreign key to gender lookup value" },
            { "name": "id_number", "data_type": "VARCHAR(50)", "nullable": true, "unique": true, "default": null, "comment": "National ID or passport number (unique if applicable)" },
            { "name": "nationality", "data_type": "VARCHAR(100)", "nullable": true, "unique": false, "default": null, "comment": "Employee's nationality" },
            { "name": "hire_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Employee's hire date" },
            { "name": "status_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employee status lookup value (e.g., Active, Terminated)" },
            { "name": "email", "data_type": "VARCHAR(100)", "nullable": true, "unique": false, "default": null, "comment": "Employee's email address" },
            { "name": "phone_number", "data_type": "VARCHAR(50)", "nullable": true, "unique": false, "default": null, "comment": "Employee's phone number" },
            { "name": "created_at", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": false, "unique": false, "default": "NOW()", "comment": "Record creation timestamp" },
            { "name": "updated_at", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": false, "unique": false, "default": "NOW()", "comment": "Record last update timestamp" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_employees_gender", "from_columns": ["gender_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "SET NULL" },
            { "name": "fk_employees_status", "from_columns": ["status_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [ { "name": "uq_employees_employee_code", "columns": ["employee_code"] }, { "name": "uq_employees_id_number", "columns": ["id_number"] } ],
          "check_constraints": []
        },
        {
          "name": "departments",
          "description": "Organizational departments.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique department code" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Department name" },
            { "name": "parent_department_id", "data_type": "BIGINT", "nullable": true, "unique": false, "default": null, "comment": "Foreign key to parent department (for hierarchy)" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Department definition effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Department definition end date" },
             { "name": "is_active", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether the department is currently active" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
             { "name": "fk_departments_parent", "from_columns": ["parent_department_id"], "to_table": "hr.departments", "to_columns": ["id"], "on_delete": "SET NULL" }
          ],
          "unique_constraints": [ { "name": "uq_departments_code", "columns": ["code"] } ],
          "check_constraints": []
        },
         {
          "name": "job_titles",
          "description": "Definitions of job titles/positions, supporting hierarchical tree structure.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique job title code" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Job title name" },
            { "name": "description", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Description of the job title" },
            { "name": "parent_job_title_id", "data_type": "BIGINT", "nullable": true, "unique": false, "default": null, "comment": "Self-reference to parent job title for hierarchical structure" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Job title definition effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Job title definition end date" },
            { "name": "is_active", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether the job title is currently in use" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_job_titles_parent", "from_columns": ["parent_job_title_id"], "to_table": "hr.job_titles", "to_columns": ["id"], "on_delete": "SET NULL" }
          ],
          "unique_constraints": [ { "name": "uq_job_titles_code", "columns": ["code"] } ],
          "check_constraints": []
        },
        {
          "name": "employee_job_history",
          "description": "History of employee's department, job title, and manager assignments.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "department_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to departments at this period" },
            { "name": "job_title_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to job_titles at this period" },
            { "name": "manager_id", "data_type": "BIGINT", "nullable": true, "unique": false, "default": null, "comment": "Foreign key to manager employee at this period" },
            { "name": "location", "data_type": "VARCHAR(100)", "nullable": true, "unique": false, "default": null, "comment": "Work location at this period" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Record effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Record end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_employee_job_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_employee_job_department", "from_columns": ["department_id"], "to_table": "hr.departments", "to_columns": ["id"], "on_delete": "RESTRICT" },
            { "name": "fk_employee_job_title", "from_columns": ["job_title_id"], "to_table": "hr.job_titles", "to_columns": ["id"], "on_delete": "RESTRICT" },
            { "name": "fk_employee_job_manager", "from_columns": ["manager_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "SET NULL" }
          ],
          "unique_constraints": [ { "name": "uq_employee_job_history_effective", "columns": ["employee_id", "effective_date"] } ],
          "check_constraints": []
        },
        {
          "name": "employee_contracts",
          "description": "History of employee contracts.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "contract_type_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to contract type lookup value" },
            { "name": "contract_start_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Contract start date" },
            { "name": "contract_end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Contract end date" },
            { "name": "signing_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Contract signing date" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Record effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Record end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_employee_contracts_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_employee_contracts_type", "from_columns": ["contract_type_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        },
        {
          "name": "employee_compensation_history",
          "description": "History of employee's salary and compensation changes.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "salary_amount", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": null, "comment": "Salary amount" },
            { "name": "currency", "data_type": "VARCHAR(10)", "nullable": false, "unique": false, "default": null, "comment": "Currency code (e.g., CNY, USD)" },
            { "name": "pay_frequency_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to pay frequency lookup value" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Compensation effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Compensation end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_employee_compensation_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_employee_compensation_frequency", "from_columns": ["pay_frequency_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        },
        {
          "name": "employee_payroll_components",
          "description": "Assigns specific payroll components and their parameters to individual employees.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "component_definition_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to payroll_component_definitions" },
            { "name": "fixed_amount", "data_type": "NUMERIC(18, 4)", "nullable": true, "unique": false, "default": null, "comment": "Fixed amount for this component if applicable to this employee" },
            { "name": "percentage", "data_type": "NUMERIC(5, 4)", "nullable": true, "unique": false, "default": null, "comment": "Percentage for this component if applicable to this employee" },
            { "name": "parameters", "data_type": "JSONB", "nullable": true, "unique": false, "default": null, "comment": "Employee-specific parameters, overrides general definition" },
            { "name": "effective_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Assignment effective date" },
            { "name": "end_date", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Assignment end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_employee_pc_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_employee_pc_definition", "from_columns": ["component_definition_id"], "to_table": "config.payroll_component_definitions", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        }
        ,
        {
          "name": "leave_types",
          "description": "Defines different types of leave.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique leave type code (e.g., AnnualLeave, SickLeave)" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Leave type name" },
            { "name": "accrual_rule_definition": "JSONB", "data_type": "JSONB", "nullable": true, "unique": false, "default": null, "comment": "Definition of how this leave type accrues (e.g., per month, per year based on service)" },
            { "name": "is_paid", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether this leave type is paid" },
            { "name": "is_active", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether this leave type is active" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [{ "name": "uq_leave_types_code", "columns": ["code"] }],
          "check_constraints": []
        },
         {
          "name": "employee_leave_balances",
          "description": "Stores employee leave balances.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "leave_type_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to leave_types" },
            { "name": "balance_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Date for which the balance is recorded" },
            { "name": "hours_accrued", "data_type": "NUMERIC(8, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Hours accrued up to this date" },
            { "name": "hours_taken", "data_type": "NUMERIC(8, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Hours taken up to this date" },
            { "name": "hours_adjusted", "data_type": "NUMERIC(8, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Hours adjusted (manual, carry-over) up to this date" },
            { "name": "current_balance", "data_type": "NUMERIC(8, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Current balance (accrued - taken + adjusted)" },
            { "name": "effective_date": "DATE", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Balance record effective date" },
            { "name": "end_date": "DATE", "data_type": "DATE", "nullable": true, "unique": false, "default": null, "comment": "Balance record end date" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
             { "name": "fk_employee_lb_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
             { "name": "fk_employee_lb_leavetype", "from_columns": ["leave_type_id"], "to_table": "hr.leave_types", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        },
         {
          "name": "employee_leave_requests",
          "description": "Records employee leave requests.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "leave_type_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to leave_types" },
            { "name": "start_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Leave start date" },
            { "name": "end_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Leave end date" },
            { "name": "requested_hours", "data_type": "NUMERIC(8, 4)", "nullable": true, "unique": false, "default": null, "comment": "Total hours requested" },
            { "name": "status_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to leave request status lookup value (e.g., Pending, Approved, Rejected)" },
            { "name": "requested_at", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": false, "unique": false, "default": "NOW()", "comment": "Request timestamp" },
            { "name": "approved_by_employee_id", "data_type": "BIGINT", "nullable": true, "unique": false, "default": null, "comment": "Foreign key to employee who approved (if approved)" },
            { "name": "approved_at", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": true, "unique": false, "default": null, "comment": "Approval timestamp" },
             { "name": "rejection_reason", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Reason for rejection" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
             { "name": "fk_employee_lr_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
             { "name": "fk_employee_lr_leavetype", "from_columns": ["leave_type_id"], "to_table": "hr.leave_types", "to_columns": ["id"], "on_delete": "RESTRICT" },
             { "name": "fk_employee_lr_status", "from_columns": ["status_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" },
             { "name": "fk_employee_lr_approved_by", "from_columns": ["approved_by_employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "SET NULL" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        }
      ]
    },
    {
      "name": "payroll",
      "description": "Stores payroll periods, runs, and calculation results.",
      "tables": [
        {
          "name": "payroll_periods",
          "description": "Defines payroll periods.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Payroll period name (e.g., 2024-01 Monthly)" },
            { "name": "start_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Period start date" },
            { "name": "end_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Period end date" },
            { "name": "pay_date", "data_type": "DATE", "nullable": false, "unique": false, "default": null, "comment": "Date when payment is scheduled/made" },
            { "name": "frequency_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to pay frequency lookup value (e.g., Monthly, Weekly)" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
             { "name": "fk_payroll_periods_frequency", "from_columns": ["frequency_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [ { "name": "uq_payroll_periods_dates_frequency", "columns": ["start_date", "end_date", "frequency_lookup_value_id"] } ],
          "check_constraints": []
        },
        {
          "name": "payroll_runs",
          "description": "Represents a specific payroll calculation batch/run.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "payroll_period_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to the payroll period" },
            { "name": "run_date", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": false, "unique": false, "default": "NOW()", "comment": "Timestamp of the payroll run execution" },
            { "name": "status_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to run status lookup value (e.g., Processing, Completed, Archived)" },
            { "name": "initiated_by_user_id", "data_type": "BIGINT", "nullable": true, "unique": false, "default": null, "comment": "Foreign key to user who initiated the run" },
            { "name": "total_employees", "data_type": "INTEGER", "nullable": true, "unique": false, "default": null, "comment": "Total number of employees processed in this run" },
            { "name": "total_net_pay", "data_type": "NUMERIC(18, 4)", "nullable": true, "unique": false, "default": null, "comment": "Total net pay amount for this run" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
             { "name": "fk_payroll_runs_period", "from_columns": ["payroll_period_id"], "to_table": "payroll.payroll_periods", "to_columns": ["id"], "on_delete": "RESTRICT" },
             { "name": "fk_payroll_runs_status", "from_columns": ["status_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" },
             { "name": "fk_payroll_runs_initiated_by", "from_columns": ["initiated_by_user_id"], "to_table": "security.users", "to_columns": ["id"], "on_delete": "SET NULL" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        },
        {
          "name": "payroll_entries",
          "description": "Stores the detailed payroll calculation result for each employee for each payroll period.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to employees" },
            { "name": "payroll_period_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to the payroll period" },
            { "name": "payroll_run_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to the specific payroll run this result belongs to" },
            { "name": "gross_pay", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Total gross pay (應發合計)" },
            { "name": "total_deductions", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Total deductions (應扣合計)" },
            { "name": "net_pay", "data_type": "NUMERIC(18, 4)", "nullable": false, "unique": false, "default": "0", "comment": "Total net pay (實發合計)" },
            { "name": "earnings_details", "data_type": "JSONB", "nullable": false, "unique": false, "default": "{}", "comment": "JSONB object storing individual earning items (key: component code, value: amount)" },
            { "name": "deductions_details", "data_type": "JSONB", "nullable": false, "unique": false, "default": "{}", "comment": "JSONB object storing individual deduction items (key: component code, value: amount)" },
             { "name": "calculation_inputs", "data_type": "JSONB", "nullable": true, "unique": false, "default": null, "comment": "Optional JSONB for storing calculation input values (e.g., contribution bases, hours worked) used in this specific entry's calculation run" },
            { "name": "calculation_log", "data_type": "JSONB", "nullable": true, "unique": false, "default": null, "comment": "Optional JSONB for storing calculation log/details for this employee/period" },
             { "name": "status_lookup_value_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to payroll entry status (e.g., Draft, Finalized, Paid)" },
            { "name": "remarks", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Remarks for this payroll entry, as seen in examples" },
            { "name": "calculated_at", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": false, "unique": false, "default": "NOW()", "comment": "Timestamp when this entry was calculated" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_payroll_entries_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_payroll_entries_period", "from_columns": ["payroll_period_id"], "to_table": "payroll.payroll_periods", "to_columns": ["id"], "on_delete": "RESTRICT" },
            { "name": "fk_payroll_entries_run", "from_columns": ["payroll_run_id"], "to_table": "payroll.payroll_runs", "to_columns": ["id"], "on_delete": "CASCADE" },
             { "name": "fk_payroll_entries_status", "from_columns": ["status_lookup_value_id"], "to_table": "config.lookup_values", "to_columns": ["id"], "on_delete": "RESTRICT" }
          ],
          "unique_constraints": [ { "name": "uq_payroll_entries_employee_period_run", "columns": ["employee_id", "payroll_period_id", "payroll_run_id"] } ],
          "check_constraints": []
        }
      ]
    },
    {
      "name": "security",
      "description": "Basic user and role-based access control.",
      "tables": [
        {
          "name": "users",
          "description": "System users.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "username", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique username" },
            { "name": "password_hash", "data_type": "VARCHAR(255)", "nullable": false, "unique": false, "default": null, "comment": "Hashed password" },
            { "name": "employee_id", "data_type": "BIGINT", "nullable": true, "unique": true, "default": null, "comment": "Optional link to an employee" },
            { "name": "is_active", "data_type": "BOOLEAN", "nullable": false, "unique": false, "default": "TRUE", "comment": "Whether the user account is active" },
            { "name": "created_at", "data_type": "TIMESTAMP WITH TIME ZONE", "nullable": false, "unique": false, "default": "NOW()", "comment": "User creation timestamp" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [
            { "name": "fk_users_employee", "from_columns": ["employee_id"], "to_table": "hr.employees", "to_columns": ["id"], "on_delete": "SET NULL" }
          ],
          "unique_constraints": [ { "name": "uq_users_username", "columns": ["username"] }, { "name": "uq_users_employee_id", "columns": ["employee_id"] } ],
          "check_constraints": []
        },
        {
          "name": "roles",
          "description": "System roles (e.g., Admin, HR Manager).",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique role code" },
            { "name": "name", "data_type": "VARCHAR(100)", "nullable": false, "unique": false, "default": null, "comment": "Role name" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [ { "name": "uq_roles_code", "columns": ["code"] } ],
          "check_constraints": []
        },
        {
          "name": "user_roles",
          "description": "Links users to roles (many-to-many).",
          "columns": [
            { "name": "user_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to users" },
            { "name": "role_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to roles" }
          ],
          "primary_key": ["user_id", "role_id"],
          "foreign_keys": [
            { "name": "fk_user_roles_user", "from_columns": ["user_id"], "to_table": "security.users", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_user_roles_role", "from_columns": ["role_id"], "to_table": "security.roles", "to_columns": ["id"], "on_delete": "CASCADE" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        },
        {
          "name": "permissions",
          "description": "Defines system permissions.",
          "columns": [
            { "name": "id", "data_type": "BIGSERIAL", "nullable": false, "unique": false, "default": null, "comment": "Primary key" },
            { "name": "code", "data_type": "VARCHAR(50)", "nullable": false, "unique": true, "default": null, "comment": "Unique permission code (e.g., payroll:view, employee:edit)" },
            { "name": "description", "data_type": "TEXT", "nullable": true, "unique": false, "default": null, "comment": "Description of the permission" }
          ],
          "primary_key": ["id"],
          "foreign_keys": [],
          "unique_constraints": [ { "name": "uq_permissions_code", "columns": ["code"] } ],
          "check_constraints": []
        },
        {
          "name": "role_permissions",
          "description": "Links roles to permissions (many-to-many).",
          "columns": [
            { "name": "role_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to roles" },
            { "name": "permission_id", "data_type": "BIGINT", "nullable": false, "unique": false, "default": null, "comment": "Foreign key to permissions" }
          ],
          "primary_key": ["role_id", "permission_id"],
          "foreign_keys": [
            { "name": "fk_role_permissions_role", "from_columns": ["role_id"], "to_table": "security.roles", "to_columns": ["id"], "on_delete": "CASCADE" },
            { "name": "fk_role_permissions_permission", "from_columns": ["permission_id"], "to_table": "security.permissions", "to_columns": ["id"], "on_delete": "CASCADE" }
          ],
          "unique_constraints": [],
          "check_constraints": []
        }
      ]
    }
  ]
}